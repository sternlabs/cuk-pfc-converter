Version 4
SHEET 1 2608 884
WIRE 496 -32 304 -32
WIRE 768 -32 576 -32
WIRE 128 80 0 80
WIRE 304 80 304 -32
WIRE 304 80 208 80
WIRE 352 80 304 80
WIRE 432 80 352 80
WIRE 592 80 496 80
WIRE 768 80 768 -32
WIRE 768 80 672 80
WIRE 896 80 768 80
WIRE 944 80 896 80
WIRE 1088 80 1008 80
WIRE 1184 80 1088 80
WIRE 0 128 0 80
WIRE 352 128 352 80
WIRE 896 128 896 80
WIRE 1088 128 1088 80
WIRE 1184 128 1184 80
WIRE 256 144 208 144
WIRE 304 144 256 144
WIRE -880 176 -960 176
WIRE -960 208 -960 176
WIRE -304 208 -384 208
WIRE -384 256 -384 208
WIRE 0 288 0 208
WIRE 304 288 304 192
WIRE 304 288 0 288
WIRE 352 288 352 208
WIRE 352 288 304 288
WIRE 480 288 352 288
WIRE 640 288 480 288
WIRE 896 288 896 192
WIRE 896 288 640 288
WIRE 1088 288 1088 192
WIRE 1088 288 896 288
WIRE 1184 288 1184 208
WIRE 1184 288 1088 288
WIRE 480 368 480 288
WIRE 640 368 640 288
WIRE -224 560 -288 560
WIRE 320 560 256 560
WIRE 752 560 688 560
WIRE -288 576 -288 560
WIRE 256 576 256 560
WIRE 688 576 688 560
WIRE -288 672 -288 656
WIRE 256 672 256 656
WIRE 688 672 688 656
WIRE 320 752 256 752
WIRE 752 752 688 752
WIRE 256 768 256 752
WIRE 688 768 688 752
WIRE 256 864 256 848
WIRE 688 864 688 848
FLAG 480 368 0
FLAG 640 368 0
FLAG 256 144 Vsw
FLAG 256 864 0
FLAG 256 672 0
FLAG 688 864 0
FLAG 320 752 off_ramp
FLAG 320 560 on_trigger
FLAG -384 336 0
FLAG 688 672 0
FLAG 752 752 on_ramp
FLAG 752 560 on_safety
FLAG -288 672 0
FLAG -224 560 on_output
FLAG -880 176 Vsw
FLAG -960 288 0
FLAG -304 208 V_gen
SYMBOL voltage 0 112 R0
WINDOW 123 24 124 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V1
SYMATTR Value 230
SYMBOL sw 352 224 M180
SYMATTR InstName S1
SYMATTR Value ""
SYMATTR SpiceModel sw1
SYMBOL diode 912 192 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMBOL diode 944 96 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D2
SYMBOL ind2 112 64 M90
WINDOW 0 5 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName L1
SYMATTR Value 10m
SYMATTR Type ind
SYMATTR SpiceLine Rser=1
SYMBOL cap 1104 192 R180
WINDOW 0 24 56 Left 2
WINDOW 3 24 8 Left 2
SYMATTR InstName C3
SYMATTR Value 200µ
SYMATTR SpiceLine Rser=10m
SYMBOL res 1168 112 R0
SYMATTR InstName R1
SYMATTR Value 200
SYMBOL ind 688 64 R90
WINDOW 0 5 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName L4
SYMATTR Value 2.2µ
SYMATTR SpiceLine Rser=50m
SYMBOL voltage -384 240 R0
WINDOW 123 24 124 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V2
SYMATTR Value PULSE(0 1 100n 100n 100n {onT} {onT+offT})
SYMBOL cap 496 64 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C2
SYMATTR Value 3.3µ
SYMATTR SpiceLine Rser=50m
SYMBOL current 496 -32 R270
WINDOW 0 32 40 VTop 2
WINDOW 3 -32 40 Invisible 2
WINDOW 39 0 0 Left 2
SYMATTR InstName I1
SYMATTR Value 0
SYMATTR Value2 AC 1.0
SYMBOL bv 256 752 M0
SYMATTR InstName B1
SYMATTR Value V=idt(1,0,I(L4)>1m)
SYMBOL bv 256 560 M0
SYMATTR InstName B2
SYMATTR Value V=(V(off_ramp)>={offT}) | (I(L4) >= 1m)
SYMBOL bv 688 752 M0
SYMATTR InstName B3
SYMATTR Value V=idt(1,0,V(on_trigger) == 0)
SYMBOL bv 688 560 M0
SYMATTR InstName B4
SYMATTR Value V=V(on_ramp) >= 200u
SYMBOL bv -288 560 M0
SYMATTR InstName B5
SYMATTR Value V=V(on_trigger) & !V(on_safety)
SYMBOL bv -960 192 R0
SYMATTR InstName B6
SYMATTR Value V=if(time <50m,V(V_gen),V(on_output))
TEXT 344 432 Left 2 !.tran 0 60m 0 0.1u uic
TEXT 584 424 Left 2 !.model sw1 SW(Ron=1m Roff=100Meg Vt=0.5 Vh=-0.4)
TEXT 664 200 Left 2 ;K1 L2 L3 1
TEXT 1248 424 Left 2 !.param f 59k\n.param Dr 0.5\n.param p_len 1\n.param on_len 1\n.param onT {1/f/2*on_len}\n.param offT {onT/Dr}
TEXT 1336 136 Left 2 ;.step param Dr 0.2 2 0.2
TEXT 1336 184 Left 2 !.measure tran i_in rms I(L1) TRIG V(Vsw) VAL=0.5 RISE=1 TARG V(Vsw) VAL=0.5 RISE=2\n.measure tran i_L4_max max I(L4)
